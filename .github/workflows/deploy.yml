name: ğŸš€ Deploy automÃ¡tico a VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted  # âœ… Se ejecuta directamente en tu VPS

    steps:
      - name: ğŸ§© Checkout del repositorio
        uses: actions/checkout@v4

      - name: ğŸš€ Deploy al servidor VPS
        run: |
          cd /var/www/ln1_ai_agents_api
          echo "ğŸ“¦ Actualizando repositorio..."
          git pull origin main
          
          echo "ğŸ§± Reconstruyendo contenedores..."
          docker compose up --build -d

      - name: ğŸ§¹ Limpiar imÃ¡genes antiguas (seguro)
        run: |
          echo "ğŸ§¹ Eliminando imÃ¡genes no utilizadas (excepto las con label keep=true)..."
          docker image prune -a -f --filter "label!=keep"
          
          echo "âœ… Limpieza completada"
